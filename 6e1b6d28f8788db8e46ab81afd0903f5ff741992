{
  "comments": [
    {
      "key": {
        "uuid": "bdd97277_131f0108",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1308504
      },
      "writtenOn": "2019-08-23T06:03:54Z",
      "side": 1,
      "message": "I know you want to keep use legacy one first. Could you add the control flag (maybe reference DhcpServer which is control by settings at line.334~337) ? It would be helpful for local testing.\n\ne.g.\n    private static boolean getEnableLegacyDnsProxyServer(Context ctx) {\n        final ContentResolver cr \u003d ctx.getContentResolver();\n        // Default enable legacy dns proxy server.\n        final int intVal \u003d Settings.Global.getInt(cr, TETHER_ENABLE_LEGACY_DNSP_ROXY_SERVER, 1);\n        return intVal !\u003d 0;\n    }",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4a6e3d57_107d13af",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1337176
      },
      "writtenOn": "2019-08-23T06:45:29Z",
      "side": 1,
      "message": "DeviceConfig version in ag/9242558\nHowever, DeviceConfig is not available here, just add interface for now",
      "parentUuid": "bdd97277_131f0108",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b5b4eff_27552499",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2019-08-30T12:48:22Z",
      "side": 1,
      "message": "You should be able to use NetworkStackUtils.getDeviceConfigProperty right now, and it will work without you having to come back here when it\u0027s available.",
      "parentUuid": "4a6e3d57_107d13af",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4058e0c7_349d27bd",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1288034
      },
      "writtenOn": "2019-09-02T03:38:28Z",
      "side": 1,
      "message": "Also no boolean flags should be pushed from the server, only int flags to compare with the module\u0027s version (so flags value X means \"enable this feature for module version \u003e\u003d X\").\n\nThis is important to ensure that when modules get rolled back, the features don\u0027t remain enabled on a version where they haven\u0027t been tested properly.\n\nXiao is working on this (probably including some utilities to check the flag values properly), so maybe you can see together with him ?",
      "parentUuid": "3b5b4eff_27552499",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2a3a589_efbe6eee",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1337176
      },
      "writtenOn": "2019-09-03T12:09:46Z",
      "side": 1,
      "message": "\u003e You should be able to use NetworkStackUtils.getDev\n\nNot sure I understand correctly, we don\u0027t build NetworkStackUtils here, right?\n\u003e Also no boolean flags should be pushed from the server ...\n    Sounds a good approach, I will update it in ag/9242558 since no DeviceConfig here.",
      "parentUuid": "4058e0c7_349d27bd",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1ecadffb_d0d06c8b",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1337176
      },
      "writtenOn": "2019-09-09T03:30:54Z",
      "side": 1,
      "message": "I re-think this problem. \nYeah, we prababaly don\u0027t need DeviceFlags to control this feature.\nThis feature is for Android R, it might be tested in R devices first.\nHow can R dogfood users get the mainline update? Is there any specific process of mainline for R dogfood updating?\nOr they will just get the update by rom updating?\n\nLooks like having a version control is not useful in this case.\nAnyway, I think we could just merge this. Once we decide to enable new DnsProxy, we could refine the control mechanism.",
      "parentUuid": "e2a3a589_efbe6eee",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eea5e050_737221c2",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1288034
      },
      "writtenOn": "2019-09-09T04:44:39Z",
      "side": 1,
      "message": "Right now the latest plan is to have the APK in the system image for R builds; so basically R builds get the latest version of what you merge here.\nIt\u0027s true that because this feature would only be used on R, you can ship it as any platform feature, without a flag rollout. But this is only because you happen to implement it early in R cycle, so you know that with a flag rollout it would 100% well before R is released anyway.\nI\u0027d still encourage having a flag for the feature because:\n - This would be consistent with development practices at other points in the development cycle\n - This will allow A/B testing at least on dogfood images, so you can measure impact of the feature - assuming you have metrics you\u0027d like to verify.",
      "parentUuid": "1ecadffb_d0d06c8b",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "58ddeed0_d485fb79",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1406251
      },
      "writtenOn": "2019-09-09T05:35:40Z",
      "side": 1,
      "message": "If a flag is required, we can determine whether or not to enable it by comparing the package version and flag version, maybe something like below:\n\nfinal long packageVersion \u003d context.getPackageManager().getPackageInfo(context.getPackageName(), 0).getLongVersionCode();\nfinal int flagVersion \u003d NetworkStackUtils.getDeviceConfigPropertyInt(nameSpace, flagName, defaultValue);\nreturn (flagVersion !\u003d 0 \u0026\u0026 packageVersion \u003e\u003d (long) flagVersion);",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 19
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "beb00cb3_1eb5eef6",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1337176
      },
      "writtenOn": "2019-09-09T08:43:39Z",
      "side": 1,
      "message": "1\u003e - This would be consistent with development practices at other points in the development cycle\n    I think it is better to have 2 different pratices for pure mainline and Android R if the release procedure is  much differnce.\n\u003e - This will allow A/B testing at least on dogfood images, so you can measure impact of the feature - assuming you have metrics you\u0027d like to verify.\n    Having metrics would be good, but we don\u0027t have any data in legacy mode. So we prabably don\u0027t need to do A/B tesing, maybe just measure some items under new DnsProxyServer? Any thoughts? I think we could add it later just before enalbing new path if we want.",
      "parentUuid": "eea5e050_737221c2",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 20
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c6fcd639_f2f734e3",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1337176
      },
      "writtenOn": "2019-09-09T08:43:39Z",
      "side": 1,
      "message": "I see. In system server, looks like we could use \"com.android.networkstack\" as package name, right?\nDo we need to check if it is inprocess or not?",
      "parentUuid": "58ddeed0_d485fb79",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 19
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "11d4edf3_07312aa5",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1288034
      },
      "writtenOn": "2019-09-09T08:56:25Z",
      "side": 1,
      "message": "I\u0027m suspecting context.getPackageName() would still return the right value when the package is running in the system server process - but you might want to check ?\nSince the above pattern from Xiao is going to be the same for all features, I think we need a utility class to implement it (I think Xiao started looking at that ?)",
      "parentUuid": "c6fcd639_f2f734e3",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 19
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "99e11d40_c86c4596",
        "filename": "services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java",
        "patchSetId": 1
      },
      "lineNbr": 340,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2019-10-03T02:50:34Z",
      "side": 1,
      "message": "I\u0027m being super late to the party but let me observe a number of things.\n\n• Feature flags have an extreme tendency to creep and very easily become unmanageable. I think should be an general effort to avoid feature flags generally whenever sane. You don\u0027t want to live in a world where you have 20 concurrent feature flags to handle ; we already are trying to bite a lot more with the m*n problem caused by module version m running on platform version n, and a feature flag is an exponential increase in combination number with every flag we add. Down the trigger-happy path for feature flags lies madness.\n• In this case I think Luke makes two cogent points. One, this only ever releases to R. Two, there is no possible comparative metrics because we don\u0027t have old metrics.\n\nTherefore I think there are only two sane paths forward. Either we decide that we NEED metrics to release this, and then we shelve this work in favor of building old metrics first. Or we don\u0027t add a feature flag for this. I lean toward the latter.\n\n...and by the way if we don\u0027t add a feature flag for this, I see little point in having a getEnableLegacyDnsProxyServer() method, unless it eases development.",
      "parentUuid": "11d4edf3_07312aa5",
      "range": {
        "startLine": 340,
        "startChar": 8,
        "endLine": 340,
        "endChar": 19
      },
      "revId": "6e1b6d28f8788db8e46ab81afd0903f5ff741992",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}