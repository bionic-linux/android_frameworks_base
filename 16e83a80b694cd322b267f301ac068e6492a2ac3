{
  "comments": [
    {
      "key": {
        "uuid": "eecfddec_1211a989",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1140984
      },
      "writtenOn": "2020-07-08T07:58:30Z",
      "side": 1,
      "message": "Could you please review this change?\n\nThanks",
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ed9028dc_54821337",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1387508
      },
      "writtenOn": "2020-07-08T13:15:49Z",
      "side": 1,
      "message": "Thanks very much for the patch. Would you mind adding automated unit tests in BluetoothControllerImplTest to verify the fix?",
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d4bbd44d_f5e2ddf3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1140984
      },
      "writtenOn": "2020-07-08T15:57:31Z",
      "side": 1,
      "message": "Dear Fabian Kozynski\nThanks for your quick reply.\n\nOriginally, I also wanted to provide unit test.\nBut I didn\u0027t write the unit test due to below reasons:\n1. It is just add null check for printing verbose logs, which can\u0027t be observed in normal case.(BluetoothControllerImpl#DEBUG must be true, adb shell setprop persist.log.tag.BluetoothController V)\n2. We don\u0027t change any main code logic, i.e. the work flow of BluetoothControllerImpl.\n\nDo we still need to add unit test?\nIf you still recommend that it is necessary to add unit test.\nJust in case, please allow me to double confirm the unit test implementation detail.\n\nDo you mean, we need to add unit test to verify when:\n1. verbose log is enabled, i.e. BluetoothControllerImpl#DEBUG is true\n2. Trigger BluetoothCallback#onConnectionStateChanged, BluetoothCallback#onActiveDeviceChanged with null CachedBluetoothDevice object\n\nThen the unit test should check there is no NPE occurrs with all above condtion met.\n\nPlease kindly share your opinion, then I\u0027ll proceed with necessary action.\n\nThanks",
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ba8b2ef0_117c85d5",
        "filename": "packages/SystemUI/src/com/android/systemui/statusbar/policy/BluetoothControllerImpl.java",
        "patchSetId": 2
      },
      "lineNbr": 313,
      "author": {
        "id": 1140984
      },
      "writtenOn": "2020-07-08T07:52:03Z",
      "side": 1,
      "message": "Should not null, see below:\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#293\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#301",
      "range": {
        "startLine": 313,
        "startChar": 47,
        "endLine": 313,
        "endChar": 59
      },
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6434bc0_b40f860f",
        "filename": "packages/SystemUI/src/com/android/systemui/statusbar/policy/BluetoothControllerImpl.java",
        "patchSetId": 2
      },
      "lineNbr": 321,
      "author": {
        "id": 1140984
      },
      "writtenOn": "2020-07-08T07:52:03Z",
      "side": 1,
      "message": "Should not null, see below:\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/HearingAidDeviceManager.java#148\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/HearingAidDeviceManager.java#171\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/HearingAidDeviceManager.java#193",
      "range": {
        "startLine": 321,
        "startChar": 49,
        "endLine": 321,
        "endChar": 61
      },
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "533c42cc_5a1f3011",
        "filename": "packages/SystemUI/src/com/android/systemui/statusbar/policy/BluetoothControllerImpl.java",
        "patchSetId": 2
      },
      "lineNbr": 329,
      "author": {
        "id": 1140984
      },
      "writtenOn": "2020-07-08T07:52:03Z",
      "side": 1,
      "message": "Should not null, see below:\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#339\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#346",
      "range": {
        "startLine": 329,
        "startChar": 58,
        "endLine": 329,
        "endChar": 70
      },
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27fd04b7_673d22fc",
        "filename": "packages/SystemUI/src/com/android/systemui/statusbar/policy/BluetoothControllerImpl.java",
        "patchSetId": 2
      },
      "lineNbr": 343,
      "author": {
        "id": 1140984
      },
      "writtenOn": "2020-07-08T07:52:03Z",
      "side": 1,
      "message": "Could be null, see below:\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/CachedBluetoothDeviceManager.java#90\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#316\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#319",
      "range": {
        "startLine": 343,
        "startChar": 63,
        "endLine": 343,
        "endChar": 75
      },
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "039f3002_a8301a5c",
        "filename": "packages/SystemUI/src/com/android/systemui/statusbar/policy/BluetoothControllerImpl.java",
        "patchSetId": 2
      },
      "lineNbr": 355,
      "author": {
        "id": 1140984
      },
      "writtenOn": "2020-07-08T07:52:03Z",
      "side": 1,
      "message": "Could be null, see below:\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/CachedBluetoothDeviceManager.java#90\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#431\nhttps://android.googlesource.com/platform/frameworks/base/+/refs/heads/master/packages/SettingsLib/src/com/android/settingslib/bluetooth/BluetoothEventManager.java#443\n\nI also observed crash on Android Q device:\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: FATAL EXCEPTION: SysUiBg\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: Process: com.android.systemui, PID: 2082\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: java.lang.RuntimeException: Error receiving broadcast Intent { act\u003dandroid.bluetooth.a2dp.profile.action.ACTIVE_DEVICE_CHANGED flg\u003d0x5000010 (has extras) } in com.android.settingslib.bluetooth.BluetoothEventManager$BluetoothBroadcastReceiver@806b37b\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat android.app.LoadedApk$ReceiverDispatcher$Args.lambda$getRunnable$0$LoadedApk$ReceiverDispatcher$Args(LoadedApk.java:1560)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat android.app.-$$Lambda$LoadedApk$ReceiverDispatcher$Args$_BumDX2UKsnxLVrE6UJsJZkotuA.run(Unknown Source:2)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat android.os.Handler.handleCallback(Handler.java:883)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat android.os.Handler.dispatchMessage(Handler.java:100)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat android.os.Looper.loop(Looper.java:214)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat android.os.HandlerThread.run(HandlerThread.java:67)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: Caused by: java.lang.NullPointerException: Attempt to invoke virtual method \u0027java.lang.String com.android.settingslib.bluetooth.CachedBluetoothDevice.getAddress()\u0027 on a null object reference\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat com.android.systemui.statusbar.policy.BluetoothControllerImpl.onActiveDeviceChanged(BluetoothControllerImpl.java:356)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat com.android.settingslib.bluetooth.BluetoothEventManager.dispatchActiveDeviceChanged(BluetoothEventManager.java:240)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat com.android.settingslib.bluetooth.BluetoothEventManager.access$1800(BluetoothEventManager.java:50)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat com.android.settingslib.bluetooth.BluetoothEventManager$ActiveDeviceChangedHandler.onReceive(BluetoothEventManager.java:490)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat com.android.settingslib.bluetooth.BluetoothEventManager$BluetoothBroadcastReceiver.onReceive(BluetoothEventManager.java:269)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \tat android.app.LoadedApk$ReceiverDispatcher$Args.lambda$getRunnable$0$LoadedApk$ReceiverDispatcher$Args(LoadedApk.java:1550)\n07-07 16:34:28.267  2082  2225 E AndroidRuntime: \t... 5 more",
      "range": {
        "startLine": 355,
        "startChar": 60,
        "endLine": 355,
        "endChar": 72
      },
      "revId": "16e83a80b694cd322b267f301ac068e6492a2ac3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}